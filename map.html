<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –º–∞—è–∫–∞ - Mayak Finder</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; height: 100vh; display: flex; flex-direction: column; }
        .header { background: #667eea; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .back-btn { background: rgba(255,255,255,0.2); border: none; color: white; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
        .coordinates { background: #f8f9fa; padding: 10px; text-align: center; font-family: monospace; }
        .map-container { flex: 1; width: 100%; position: relative; }
        .map-tabs { display: flex; background: #f8f9fa; border-bottom: 1px solid #ddd; }
        .tab { padding: 10px 15px; cursor: pointer; border-right: 1px solid #ddd; }
        .tab.active { background: white; font-weight: bold; }
        .map-frame { width: 100%; height: 100%; border: none; }
        .offline-message { text-align: center; padding: 50px 20px; }
        .loading { text-align: center; padding: 20px; }
    </style>
</head>
<body>
    <div class="header">
        <button class="back-btn" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
        <h2>üó∫Ô∏è –ö–∞—Ä—Ç–∞ –º–∞—è–∫–∞</h2>
    </div>
    
    <div class="coordinates" id="coordinates">
        –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç...
    </div>
    
    <div class="map-tabs">
        <div class="tab active" onclick="switchMap('google')">Google</div>
        <div class="tab" onclick="switchMap('yandex')">–Ø–Ω–¥–µ–∫—Å</div>
        <div class="tab" onclick="switchMap('osm')">OSM</div>
        <div class="tab" onclick="switchMap('offline')">–û—Ñ—Ñ–ª–∞–π–Ω</div>
    </div>
    
    <div class="map-container">
        <div id="mapContent" class="loading">
            –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...
        </div>
    </div>

    <script>
        let currentLat, currentLon;
        let currentMap = 'google';
        
        function init() {
            // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ URL
            const urlParams = new URLSearchParams(window.location.search);
            currentLat = parseFloat(urlParams.get('lat')) || 55.241867;
            currentLon = parseFloat(urlParams.get('lon')) || 72.908588;
            
            document.getElementById('coordinates').textContent = 
                `–®–∏—Ä–æ—Ç–∞: ${currentLat.toFixed(6)}, –î–æ–ª–≥–æ—Ç–∞: ${currentLon.toFixed(6)}`;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç—É
            loadMap('google');
        }
        
        function switchMap(mapType) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            currentMap = mapType;
            loadMap(mapType);
        }
        
        function loadMap(mapType) {
            const mapContent = document.getElementById('mapContent');
            
            if (!navigator.onLine && mapType !== 'offline') {
                mapContent.innerHTML = `
                    <div class="offline-message">
                        <div style="font-size: 48px;">üåê</div>
                        <h3>–ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</h3>
                        <p>–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ–Ω–ª–∞–π–Ω-–∫–∞—Ä—Ç —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É</p>
                        <button onclick="switchMap('offline')" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-top: 15px; cursor: pointer;">
                            –ü–µ—Ä–µ–π—Ç–∏ –≤ –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º
                        </button>
                    </div>
                `;
                return;
            }
            
            let mapHtml = '';
            
            switch(mapType) {
                case 'google':
                    mapHtml = `
                        <iframe class="map-frame" 
                            src="https://www.google.com/maps/embed/v1/view?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&center=${currentLat},${currentLon}&zoom=17&maptype=roadmap"
                            loading="lazy">
                        </iframe>
                        <div style="position: absolute; bottom: 10px; left: 10px; background: white; padding: 5px; border-radius: 3px; font-size: 12px;">
                            Google Maps
                        </div>
                    `;
                    break;
                    
                case 'yandex':
                    mapHtml = `
                        <iframe class="map-frame"
                            src="https://yandex.ru/maps/?pt=${currentLon},${currentLat}&z=17&l=map"
                            loading="lazy">
                        </iframe>
                        <div style="position: absolute; bottom: 10px; left: 10px; background: white; padding: 5px; border-radius: 3px; font-size: 12px;">
                            –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã
                        </div>
                    `;
                    break;
                    
                case 'osm':
                    mapHtml = `
                        <iframe class="map-frame"
                            src="https://www.openstreetmap.org/export/embed.html?bbox=${currentLon-0.01},${currentLat-0.01},${currentLon+0.01},${currentLat+0.01}&marker=${currentLat},${currentLon}&layer=mapnik"
                            loading="lazy">
                        </iframe>
                        <div style="position: absolute; bottom: 10px; left: 10px; background: white; padding: 5px; border-radius: 3px; font-size: 12px;">
                            OpenStreetMap
                        </div>
                    `;
                    break;
                    
                case 'offline':
                    mapHtml = `
                        <div class="offline-message">
                            <div style="font-size: 48px;">üß≠</div>
                            <h3>–û—Ñ—Ñ–ª–∞–π–Ω-–Ω–∞–≤–∏–≥–∞—Ç–æ—Ä</h3>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 15px 0; font-family: monospace;">
                                <div>–®–∏—Ä–æ—Ç–∞: ${currentLat.toFixed(6)}</div>
                                <div>–î–æ–ª–≥–æ—Ç–∞: ${currentLon.toFixed(6)}</div>
                            </div>
                            <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–ø–∞—Å–∞</p>
                            <button onclick="openOfflineNavigator()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-top: 15px; cursor: pointer;">
                                üß≠ –û—Ç–∫—Ä—ã—Ç—å –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä
                            </button>
                        </div>
                    `;
                    break;
            }
            
            mapContent.innerHTML = mapHtml;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –¥–ª—è iframe
            const iframe = mapContent.querySelector('iframe');
            if (iframe) {
                iframe.onerror = function() {
                    mapContent.innerHTML = `
                        <div class="offline-message">
                            <div style="font-size: 48px;">‚ùå</div>
                            <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã</h3>
                            <p>–≠—Ç–∞ –∫–∞—Ä—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p>
                            <button onclick="switchMap('${mapType === 'google' ? 'yandex' : 'osm'}')" 
                                    style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-top: 15px; cursor: pointer;">
                                –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ä—Ç—É
                            </button>
                        </div>
                    `;
                };
            }
        }
        
        function openOfflineNavigator() {
            window.open(`navigator.html?lat=${currentLat}&lon=${currentLon}`, '_blank');
        }
        
        function goBack() {
            window.history.back();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
