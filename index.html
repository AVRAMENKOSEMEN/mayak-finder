<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mayak Finder - –û—Ñ—Ñ–ª–∞–π–Ω</title>
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="–û—Ñ—Ñ–ª–∞–π–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –º–∞—è–∫–∞ –ø–æ Bluetooth">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîç</text></svg>">
    <link rel="stylesheet" href="style.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* –°—Ç–∏–ª—å –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-–±–∞–Ω–Ω–µ—Ä–∞ */
        .offline-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #ff6b6b;
            color: white;
            padding: 10px;
            text-align: center;
            z-index: 10000;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }
        
        .online-banner {
            background: #28a745;
        }
    </style>
</head>
<body>
    <div id="offlineBanner" class="offline-banner" style="display: none;">
        üî¥ –†–µ–∂–∏–º –æ—Ñ—Ñ–ª–∞–π–Ω - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã
    </div>

    <div class="container">
        <!-- –û—Å—Ç–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
        <header class="app-header">
            <h1>üîç Mayak Finder</h1>
            <button class="btn-icon" id="settingsBtn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
        </header>
        
        <div id="onlineStatus" class="status offline">
            üî¥ –†–µ–∂–∏–º –æ—Ñ—Ñ–ª–∞–π–Ω
        </div>
        
        <button id="connectBtn" class="btn primary">üì° –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Bluetooth</button>
        
        <div id="status" class="status">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</div>
        
        <div class="coordinates">
            <label>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–∞—è–∫–∞:</label>
            <div id="coordinatesText">–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –º–∞—è–∫–∞...</div>
        </div>
        
        <div class="actions">
            <button id="copyBtn" class="btn secondary" disabled>üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</button>
            <button id="openNavBtn" class="btn secondary" disabled>üß≠ –û—Ç–∫—Ä—ã—Ç—å –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä</button>
            
            <div class="light-controls">
                <button id="lightOnBtn" class="btn success" disabled>üí° –í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç</button>
                <button id="lightOffBtn" class="btn warning" disabled>üîå –í—ã–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç</button>
            </div>
            
            <button id="historyBtn" class="btn secondary">üìä –ò—Å—Ç–æ—Ä–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</button>
            <button id="testBtn" class="btn secondary">üß™ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
        </div>

        <div class="map-container">
            <label>–¢–µ–∫—É—â–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –º–∞—è–∫–∞:</label>
            <div id="map" class="map">
                <div id="staticMap">
                    <div class="map-placeholder">
                        <div class="map-icon">üó∫Ô∏è</div>
                        <div class="map-text">–î–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="log">
            <label>–õ–æ–≥ –¥–∞–Ω–Ω—ã—Ö:</label>
            <div id="dataLog"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="settingsContent">
                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <div id="historyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìä –ò—Å—Ç–æ—Ä–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="historyContent">
                <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script src="settings.js"></script>
    <script src="voice-guidance.js"></script>
    <script src="history-manager.js"></script>
    <script src="notifications.js"></script>
    <script src="offline-maps.js"></script>
    <script src="script.js"></script>

    <script>
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ:', registration.scope);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('–ù–∞–π–¥–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Service Worker');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞!');
                                    // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
                                }
                            });
                        });
                    })
                    .catch(function(error) {
                        console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ServiceWorker:', error);
                    });
            });
        }

        // –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–Ω–ª–∞–π–Ω/–æ—Ñ—Ñ–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞
        function updateOnlineStatus() {
            const isOnline = navigator.onLine;
            const banner = document.getElementById('offlineBanner');
            const statusElement = document.getElementById('onlineStatus');
            
            if (isOnline) {
                banner.style.display = 'none';
                statusElement.textContent = 'üü¢ –û–Ω–ª–∞–π–Ω —Ä–µ–∂–∏–º';
                statusElement.className = 'status online';
            } else {
                banner.style.display = 'block';
                statusElement.textContent = 'üî¥ –†–µ–∂–∏–º –æ—Ñ—Ñ–ª–∞–π–Ω';
                statusElement.className = 'status offline';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ –æ—Ñ—Ñ–ª–∞–π–Ω
                setTimeout(() => {
                    banner.textContent = 'üî¥ –†–µ–∂–∏–º –æ—Ñ—Ñ–ª–∞–π–Ω - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ';
                }, 3000);
            }
        }

        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ç–∏
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', updateOnlineStatus);

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å–≤–∞–π–ø-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ
        let touchStartY = 0;
        
        document.addEventListener('touchstart', function(e) {
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchmove', function(e) {
            if (!navigator.onLine) {
                // –í –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ –±–ª–æ–∫–∏—Ä—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞
                if (touchStartY - e.touches[0].clientY > 50) {
                    e.preventDefault();
                }
            }
        });
    </script>
</body>
</html>
